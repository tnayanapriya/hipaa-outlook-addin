<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>HIPAA Reminder</title>
    <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    <style>
      body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; margin:0; color:#111; }
      .wrap { padding: 18px; }
      h2 { margin: 0 0 10px; font-size: 18px; }
      .card { background:#f9fafb; border:1px solid #e5e7eb; border-radius:12px; padding:12px; white-space:pre-wrap; }
      .note { font-size:12px; color:#555; margin-top:10px; }
      .row { display:flex; gap:10px; justify-content:flex-end; margin-top:14px; }
      button { border:1px solid #d1d5db; background:#fff; padding:8px 14px; border-radius:10px; cursor:pointer; font-weight:600; }
      .primary { background:#2563eb; border-color:#2563eb; color:#fff; }
      .primary:disabled { opacity:.6; cursor:not-allowed; }
      label { display:flex; gap:8px; align-items:flex-start; font-size:13px; margin-top:12px; }
    </style>
    <script>
      let needsAffirm = false;
      Office.onReady(() => {
        const params = new URLSearchParams(window.location.search);
        const warnings = params.get('w') || '';
        document.getElementById('warnings').textContent = warnings;

        // If warnings mention links or risky files, require checkbox
        if (/External links|Unscannable|risky file/i.test(warnings)) {
          needsAffirm = true;
          document.getElementById('affirmWrap').style.display = 'block';
          document.getElementById('send').disabled = true;
        }
      });
      function sendResult(allow) {
        try { Office.context.ui.messageParent(allow ? "allow" : "block"); } catch(e){}
      }
      function onAffirmChange(cb) {
        if (needsAffirm) {
          document.getElementById('send').disabled = !cb.checked;
        }
      }
    </script>
  </head>
  <body>
    <div class="wrap">
      <h2>Pre-send HIPAA check</h2>
      <div class="card" id="warnings"></div>
      <div class="note">Please make sure no PHI (e.g., names + DOB, MRN, diagnoses) is exposed. For images/videos/screenshots, verify identifiers are removed.</div>

      <label id="affirmWrap" style="display:none;">
        <input type="checkbox" onchange="onAffirmChange(this)">
        <span>I confirm I reviewed the listed attachments/links and they are PHI-free.</span>
      </label>

      <div class="row">
        <button onclick="sendResult(false)">Cancel send</button>
        <button id="send" class="primary" onclick="sendResult(true)">Send anyway</button>
      </div>
    </div>
  </body>
</html>
